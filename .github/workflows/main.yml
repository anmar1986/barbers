name: Full Stack CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  # Run all CI checks in parallel
  laravel-ci:
    uses: ./.github/workflows/laravel-ci.yml
    secrets: inherit

  react-ci:
    uses: ./.github/workflows/react-ci.yml
    secrets: inherit

  flutter-ci:
    uses: ./.github/workflows/flutter-ci.yml
    secrets: inherit

  # Unified deployment summary
  deployment-summary:
    name: Deployment Summary
    runs-on: ubuntu-latest
    needs: [laravel-ci, react-ci, flutter-ci]
    if: always()

    steps:
      - name: Generate Summary
        run: |
          echo "## ðŸš€ Full Stack Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Status Overview" >> $GITHUB_STEP_SUMMARY
          echo "- **Laravel**: ${{ needs.laravel-ci.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- **React**: ${{ needs.react-ci.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Flutter**: ${{ needs.flutter-ci.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Commit**: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "**Branch**: ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "**Triggered by**: ${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
